---
title: Short-term forecasting of total Number of reported COVID-19 cases in South Africa - A Bayesian temporal modeling approch
author:
  - name: Belay Birlie Yimer
    email: belaybirlie.yimer@manchester.ac.uk
    affiliation: 
    - Arthritis Research UK Centre for Epidemiology, Division of Musculoskeletal and Dermatological Sciences, The University of Manchester, Manchester; 
    - Interuniversity Institute for Biostatistics and statistical Bioinformatics (I-BioStat), Hasselt University, Diepenbeek, Belgium.
    
  - name: Ziv Shkedy
    email: ziv.shkedy@uhasselt.be
    affiliation: 
      - Interuniversity Institute for Biostatistics and statistical Bioinformatics (I-BioStat), Hasselt University, Diepenbeek, Belgium.
abstract: |
  To be updated.
  
author_summary: |
  To be updated.

bibliography: mybibfile.bib
output: rticles::plos_article
csl: plos.csl
header-includes:
 \usepackage{float}
 \floatplacement{figure}{H}

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,fig.pos = 'H', tab.pos = 'H')
```

# Introduction

To be updated

# Methods 

## Data 

We downloaded data from Coronavirus COVID-19 (2019-nCoV) Data Repository for South Africa maintained by Data Science for Social Impact research group at the University of Pretoria [ref]. The data repository captures the daily number of new cases, number of tests, number of deaths and recoveries. Our primary outcome of interest was the daily number of newly diagnosed COVID-19 cases and the unit of time used in modelling was a day. We used the daily case reports from March 12, 2020, until February 27, 2021, in our analysis.


## Statistical analysis 
We considered two widely used temporal models to model the daily number of newly diagnosed COVID-19 cases. We let $Y(t)$ denote the daily number of newly diagnosed COVID-19 cases at time $t$ and $\mu(t)$ represent the expected number of cases at time $t$. We considered a Negative binomial distribution for $Y(t)$ to account for possible overdispersion. That is, $Y(t) \sim NB(\mu(t), \delta)$, where $\delta$ is the overdispersion parameter. We considered two temporal models to capture the trend over time: a random walk of order two ($RW(2)$) and an autoregressive model of order one ($AR(1)$) [@gomez2020bayesian]. We also considerd a $RW(1)$ model,  but the model overfits the data (see Sece 2 in the supplemntary appendix). Similarly, we considerd an $AR$ model order $p=2$ but the result is similar to $AR1$ model and we prefer the simpler $AR1$ model. 

The $AR(1)$ model [@gomez2020bayesian] is given by, 

$$
\begin{aligned}
 Y(t) &\sim NB(\mu(t), \delta) \ \ t=1, \dots, n,\\
 log(\mu(t)) &= \alpha+u_t, \\
 u_1 &\sim N(0, \tau_u(1-\rho^2)^{-1}),  \\
  u_t &=\rho u_{t-1} +\epsilon_t, \ \ t=2, \dots, n,  \\
  \epsilon_t & \sim N(0, \tau_{\epsilon}),
\end{aligned}
$$
where,  $\alpha$ is an intercept,  $\rho$ a temporal correlation term (with  $|\rho|<1$) and  $\epsilon_t$ is a Gaussian error term with zero mean and precision  $\tau_{\epsilon}$.

Similarly, the $RW(2)$ model [@gomez2020bayesian] is given by, 
$$
\begin{aligned}
 Y(t) &\sim NB(\mu(t), \delta) \ \ t=1, \dots, n,\\
 log(\mu(t)) &= \alpha+u_t, \\
 u_t-2u_{t+1}+u_{t+2} &\sim N(0, \tau_u), \ \ t=2, \dots, n,
\end{aligned}
$$
where $\alpha$ is the intercept term as before and $\tau_u$ is the precison parameter. 

The two models were fitted within the Bayesian framework using *inla* [@martins2013bayesian]. To complete the specification of both models, we assume the following priors. For the $AR(1)$ model, we denote $\theta_1=log(\tau_u(1-\rho^2))$ where $\Gamma(10,100)$ prior is specified for $\theta_1$, and we denote $\theta_2=log\frac{1+\rho}{1-\rho}$ and assume a $N(0, 0.15)$ prior for $\theta$. Similarly, we represent the precison parameter of $RW(1)$, $\tau_u$, as $\theta=log(\tau_u)$ and assume a $\Gamma (10,100)$ prior for $\theta$. To assess the models' accuracy in predicting cases, we present the forecast period's actual observed values and the predicted values.Additionally, the model fits were evaluated by using DIC (Deviance information criteria). The computer code that we used for our analyses is avaliable at https://github.com/belayb/COVIDincidenceSA/tree/master/COVIDincidenceSA.



# Results 

```{r include = FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r message = FALSE, warning = FALSE}
library(ggplot2)
library(visreg)
library(INLA)
#'library(visibly)
library(tidyverse)
library(gridExtra)
library(ggpubr)
library(patchwork)
library(lubridate)
library(kableExtra)
library(data.table)
library(sfsmisc)
```

```{r message = FALSE, warning = FALSE}
#'------------- Load data 
tests_sa <- read.csv("https://raw.githubusercontent.com/dsfsi/covid19za/master/data/covid19za_timeline_testing.csv",header=TRUE)
cases_sa <- read.csv("https://raw.githubusercontent.com/dsfsi/covid19za/master/data/covid19za_provincial_cumulative_timeline_confirmed.csv",header=TRUE)
#'------------- Prepare the two data sets to merge  
tests_sa<-tests_sa%>%mutate(date2=lubridate::ymd(YYYYMMDD))
cases_sa<-cases_sa%>%mutate(date2=lubridate::ymd(YYYYMMDD))

variable_keep_test<-c("date2","cumulative_tests")
variable_keep_cases<-c("date2","total")

sa_cov_dat<-left_join(cases_sa[,variable_keep_cases], tests_sa[,variable_keep_test], by="date2")
# sa_cov_dat[18:35,] also unknown number of tests on 25-03, and 07-04 
sa_cov_dat<-sa_cov_dat[sa_cov_dat$date2>'2020-03-09'&!is.na(sa_cov_dat$cumulative_tests),]


# You need to start from 2020-03-12 in order to properly calaculate daily cases and tests
# Compute daily cases and tests 
sa_cov_dat<-sa_cov_dat%>%mutate(Dialy_cases=-1*(lag(total)-total), Daily_tests=-1*(lag(cumulative_tests)-cumulative_tests))
sa_cov_dat<-sa_cov_dat[-1, ]

```
Figure 1 presents the daily number of reported COVID-19 cases from 12 March 2020 to 27 February 2021.  Similar to elsewhere in the world,  South Africa pass through a two-wave pandemic. The pandemic's first peak was on 07 July 2020, where up to 13944 new COVID-19 cases reported, followed by a second peak in January 2021, where more than 21,000 daily cases reported. 
Figure 2 presents the cumulative number of new reported COVID-19 cases and tests performed. To date, 8,838,937 tests have been conducted, and a total of 1,500,677 cases reported.



```{r daily-cases,out.width = "99%",fig.cap = "Daily number of COVID-19 cases in South Africa from 12/03/2020-27/02/2021."}

p1<-ggplot(sa_cov_dat, aes(x=date2, y=Dialy_cases,group=1))+geom_point()+xlab("Date")+ylab("Daily cases")+theme_bw()
p1

```


```{r cummulative,out.width = "99%",fig.cap = "The cummulative number of COVID-19 cases and Cummulative number of tests in South Africa from 12/03/2020-27/02/2021. Red-line denote the number of cases and blue-line denotes the number of tests."}

dataa<-gather(sa_cov_dat[,c("date2", "total", "cumulative_tests")], Outcome, count, total:cumulative_tests, factor_key=TRUE)
dataa<-dataa %>% 
  mutate(Type = case_when(
    Outcome=="cumulative_tests" ~ 'Tests',
    TRUE ~ 'Cases') )

p2<-ggplot(dataa,aes(x=date2, y=count,group=Type))+
  geom_line(aes(color=Type))+
  xlab("Date")+ylab("Cumulative count")+
theme_bw()+theme(legend.position="none")

p2
#p2<-ggplot(sa_cov_dat, aes(x=date2, y=total,group=1))+geom_line(size = 1.5)+xlab("Date")+ylab("Cummulative cases")+theme_bw()


#p3<-ggplot(sa_cov_dat, aes(x=date2, y=cumulative_tests,group=1))+geom_line(size = 1.5)+xlab("Date")+ylab("Cummulative tests")+theme_bw()

#p1_3<-p1/p2

#p1_3


```



```{r message = FALSE, warning = FALSE}
# Modeling Daily Cases - Negaive Binomial - AR1 and rw2 model - INLA
# crate a new process time column from date2

sa_cov_dat<-sa_cov_dat%>%mutate(time=cumsum(c(0,diff.Date(date2))))
U <- 0.5#1

hyper.prec <- list(theta = list(prior = "pc.prec", param = c(U, 0.75)))#0.01

fomula_ar1<-Dialy_cases ~ 1 + f(time, model = "ar1",
                               hyper = list(prec = list(param = c(0.1, 0.1))))
fomula_rw2<-Dialy_cases ~ 1 + f(time, model = "rw2", scale.model = TRUE, 
                              hyper = hyper.prec)

nb.ar1 <- inla(fomula_ar1,                   
               data = sa_cov_dat,
               family = "nbinomial",
               control.predictor = list(compute = TRUE),
               control.compute=list(cpo=TRUE,waic=TRUE,dic=TRUE))
nb.rw2 <- inla(fomula_rw2,                   
               data = sa_cov_dat,
               family = "nbinomial",
               control.predictor = list(compute = TRUE),
               control.compute=list(cpo=TRUE,waic=TRUE,dic=TRUE))



newdata_ar1<-cbind(sa_cov_dat[,c("date2","Dialy_cases","time")],nb.ar1$summary.fitted.values)
newdata_ar1 <- reshape:::rename(newdata_ar1, c("0.025quant"="lower", "0.975quant"="upper"))

newdata_rw2<-cbind(sa_cov_dat[,c("date2","Dialy_cases","time")],nb.rw2$summary.fitted.values)
newdata_rw2 <- reshape:::rename(newdata_rw2, c("0.025quant"="lower", "0.975quant"="upper"))

```


```{r ,out.width = "99%",fig.cap = "Fitted and observed data AR1 model"}
p_ar1_inc<-ggplot(newdata_ar1, 
                  aes(y=mean, x=date2)) +geom_blank()+geom_point(aes(y=Dialy_cases, x=date2)) +
                  geom_ribbon(aes(ymin=lower, ymax=upper), fill='blue', alpha=0.6) +
                  geom_line(aes(y=mean, x=date2)) +xlab("Date")+
                  ylab("Observed and fitted cases")+
                  labs(title = "Negative-Binomial with AR(1) model" )+
                  theme_bw()

p_rw2_inc<-ggplot(newdata_rw2, aes(y=mean, x=date2)) +
  geom_blank()+
  geom_point(aes(y=Dialy_cases, x=date2)) +
  geom_ribbon(aes(ymin=lower, ymax=upper), fill='blue', alpha=0.6) +
  geom_line(aes(y=mean, x=date2)) +xlab("Date")+ylab("Observed and fitted cases")+
  labs(title = "Negative-Binomial with RW(2) model" )+
  theme_bw()

p_ar1_cum<-newdata_ar1%>%
  mutate(Cumm_fitted=cumsum(mean), Cumm_fitted_lower=cumsum(lower),
         Cumm_fitted_upper=cumsum(upper),Cumm_observed=cumsum(Dialy_cases))%>%
  ggplot(aes(y=Cumm_fitted, x=date2)) +
  geom_blank()+
  geom_point(aes(y=Cumm_observed, x=date2)) +
  geom_ribbon(aes(ymin=Cumm_fitted_lower, ymax=Cumm_fitted_upper), fill='blue', alpha=0.6) +
  geom_line(aes(y=Cumm_fitted, x=date2)) +xlab("Date")+
  ylab("cummulative observed and fitted cases")+
  labs(title = "Negative-Binomial with AR(1) model" )+
  theme_bw()
p_rw2_cum<-newdata_rw2%>%
  mutate(Cumm_fitted=cumsum(mean), Cumm_fitted_lower=cumsum(lower),
         Cumm_fitted_upper=cumsum(upper),Cumm_observed=cumsum(Dialy_cases))%>%
  ggplot(aes(y=Cumm_fitted, x=date2)) +
  geom_blank()+
  geom_point(aes(y=Cumm_observed, x=date2)) +
  geom_ribbon(aes(ymin=Cumm_fitted_lower, ymax=Cumm_fitted_upper), fill='blue', alpha=0.6) +
  geom_line(aes(y=Cumm_fitted, x=date2)) +xlab("Date")+
  ylab("cummulative observed and fitted cases")+
  labs(title = "Negative-Binomial with RW(2) model" )+
  theme_bw()

```



```{r ,out.width = "99%",fig.cap = "Fitted and observed data AR(1) model"}
newdata_ar1$deriv<-D1ss(x=newdata_ar1$time,y=newdata_ar1$mean, spar.off=0.0)
newdata_ar1$L_deriv<-D1ss(x=newdata_ar1$time,y=newdata_ar1$lower, spar.off=0.0)
newdata_ar1$U_deriv<-D1ss(x=newdata_ar1$time,y=newdata_ar1$upper, spar.off=0.0)

p_ar1_inc_deriv_new<-ggplot(newdata_ar1, aes(y=deriv, x=date2)) +
  geom_blank()+
  geom_ribbon(aes(ymin=L_deriv, ymax=U_deriv), fill='blue', alpha=0.6) +
  geom_line(aes(y=deriv, x=date2)) +xlab("Date")+ylab("Derivative")+
  labs(title = "Derivative of the smooth Curve" )+
  geom_hline(yintercept = 0)+
  theme_bw()

p_ar1_inc/p_ar1_inc_deriv_new

# plot of cummulative overtime
#p_ar1_cum/p_rw2_cum
```

```{r ,out.width = "99%",fig.cap = "Fitted and observed data RW(2) model"}
newdata_rw2$deriv<-D1ss(x=newdata_rw2$time,y=newdata_rw2$mean, spar.off=0.0)
newdata_rw2$L_deriv<-D1ss(x=newdata_rw2$time,y=newdata_rw2$lower, spar.off=0.0)
newdata_rw2$U_deriv<-D1ss(x=newdata_rw2$time,y=newdata_rw2$upper, spar.off=0.0)

p_rw2_inc_deriv_new<-ggplot(newdata_rw2, aes(y=deriv, x=date2)) +
  geom_blank()+
  geom_ribbon(aes(ymin=L_deriv, ymax=U_deriv), fill='blue', alpha=0.6) +
  geom_line(aes(y=deriv, x=date2)) +xlab("Date")+ylab("Derivative")+
  labs(title = "Derivative of the smooth Curve" )+
  geom_hline(yintercept = 0)+
  theme_bw()

p_rw2_inc/p_rw2_inc_deriv_new

# plot of cummulative overtime
#p_ar1_cum/p_rw2_cum
```
```{r message = FALSE, warning = FALSE}
# Do Forcasting 
sa_cov_dat$Dialy_cases3<-sa_cov_dat$Dialy_cases
sa_cov_dat$Dialy_cases5<-sa_cov_dat$Dialy_cases
sa_cov_dat$Dialy_cases7<-sa_cov_dat$Dialy_cases

sa_cov_dat$Dialy_cases3[sa_cov_dat$time>339]<-NA
sa_cov_dat$Dialy_cases5[sa_cov_dat$time>337]<-NA
sa_cov_dat$Dialy_cases7[sa_cov_dat$time>345]<-NA

fomula_ar1_3<-Dialy_cases3 ~ 1 + f(time, model = "ar1",
                                hyper = list(prec = list(param = c(0.1, 0.1))))
fomula_rw2_3<-Dialy_cases3 ~ 1 + f(time, model = "rw2",
                                hyper = list(prec = list(param = c(0.1, 0.1))))
fomula_ar1_5<-Dialy_cases5 ~ 1 + f(time, model = "ar1",
                                 hyper = list(prec = list(param = c(0.1, 0.1))))
fomula_rw2_5<-Dialy_cases5 ~ 1 + f(time, model = "rw2",
                                 hyper = list(prec = list(param = c(0.1, 0.1))))
fomula_ar1_7<-Dialy_cases7 ~ 1 + f(time, model = "ar1",
                                 hyper = list(prec = list(param = c(0.1, 0.1))))
fomula_rw2_7<-Dialy_cases7 ~ 1 + f(time, model = "rw2", scale.model = TRUE, 
                              hyper = hyper.prec)

# #nb.ar1_3 <- inla(fomula_ar1_3,                   
#                data = sa_cov_dat,
#                family = "nbinomial",
#                control.predictor = list(compute = TRUE, link = 1),
#                control.compute=list(cpo=TRUE,waic=TRUE,dic=TRUE))
# nb.rw2_3 <- inla(fomula_rw2_3,                   
#                data = sa_cov_dat,
#                family = "nbinomial",
#                control.predictor = list(compute = TRUE, link = 1),
#                control.compute=list(cpo=TRUE,waic=TRUE,dic=TRUE))
# nb.ar1_5 <- inla(fomula_ar1_5,                   
#                  data = sa_cov_dat,
#                  family = "nbinomial",
#                  control.predictor = list(compute = TRUE, link = 1),
#                  control.compute=list(cpo=TRUE,waic=TRUE,dic=TRUE))
# nb.rw2_5 <- inla(fomula_rw2_5,                   
#                  data = sa_cov_dat,
#                  family = "nbinomial",
#                  control.predictor = list(compute = TRUE, link = 1),
#                  control.compute=list(cpo=TRUE,waic=TRUE,dic=TRUE))
nb.ar1_7 <- inla(fomula_ar1_7,                   
                 data = sa_cov_dat,
                 family = "nbinomial",
                 control.predictor = list(compute = TRUE, link = 1),
                 control.compute=list(cpo=TRUE,waic=TRUE,dic=TRUE))
nb.rw2_7 <- inla(fomula_rw2_7,                   
                 data = sa_cov_dat,
                 family = "nbinomial",
                 control.predictor = list(compute = TRUE, link = 1),
                 control.compute=list(cpo=TRUE,waic=TRUE,dic=TRUE))

# # nb.rw2_3_pred<-nb.rw2_3$summary.fitted.values[,c(1,3,5)]
# nb.rw2_5_pred<-nb.rw2_5$summary.fitted.values[,c(1,3,5)]
nb.rw2_7_pred<-nb.rw2_7$summary.fitted.values[,c(1,3,5)]
# nb.ar1_3_pred<-nb.ar1_3$summary.fitted.values[,c(1,3,5)]
# nb.ar1_5_pred<-nb.ar1_5$summary.fitted.values[,c(1,3,5)]
nb.ar1_7_pred<-nb.ar1_7$summary.fitted.values[,c(1,3,5)]

# nb.rw2_3_pred <- reshape:::rename(nb.rw2_3_pred, c("0.025quant"="rw2_lower", "0.975quant"="rw2_upper","mean"="rw2_mean"))
# nb.ar1_3_pred <- reshape:::rename(nb.ar1_3_pred, c("0.025quant"="AR1_lower", "0.975quant"="AR1_upper","mean"="AR1_mean"))
# Day3_pred<-cbind(sa_cov_dat,nb.rw2_3_pred,nb.ar1_3_pred)
# 
# nb.rw2_5_pred <- reshape:::rename(nb.rw2_5_pred, c("0.025quant"="rw2_lower", "0.975quant"="rw2_upper","mean"="rw2_mean"))
# nb.ar1_5_pred <- reshape:::rename(nb.ar1_5_pred, c("0.025quant"="AR1_lower", "0.975quant"="AR1_upper","mean"="AR1_mean"))
# Day5_pred<-cbind(sa_cov_dat,nb.rw2_5_pred,nb.ar1_5_pred)

nb.rw2_7_pred <- reshape:::rename(nb.rw2_7_pred, c("0.025quant"="rw2_lower", "0.975quant"="rw2_upper","mean"="rw2_mean"))
nb.ar1_7_pred <- reshape:::rename(nb.ar1_7_pred, c("0.025quant"="AR1_lower", "0.975quant"="AR1_upper","mean"="AR1_mean"))
Day7_pred<-cbind(sa_cov_dat,nb.rw2_7_pred,nb.ar1_7_pred)

#----Present the result as a table as well as plot 
Day7_pred<-Day7_pred%>%
  mutate(Cum_pred_ar1=cumsum(AR1_mean),Cum_pred_ar1_lower=cumsum(AR1_lower),Cum_pred_ar1_upper=cumsum(AR1_upper),
         Cum_pred_rw2=cumsum(rw2_mean),Cum_pred_rw2_lower=cumsum(rw2_lower),Cum_pred_rw2_upper=cumsum(rw2_upper))
# Day5_pred<-Day5_pred%>%
#   mutate(Cum_pred_ar1=cumsum(AR1_mean),Cum_pred_ar1_lower=cumsum(AR1_lower),Cum_pred_ar1_upper=cumsum(AR1_upper),
#          Cum_pred_rw2=cumsum(rw2_mean),Cum_pred_rw2_lower=cumsum(rw2_lower),Cum_pred_rw2_upper=cumsum(rw2_upper))
# Day3_pred<-Day3_pred%>%
#   mutate(Cum_pred_ar1=cumsum(AR1_mean),Cum_pred_ar1_lower=cumsum(AR1_lower),Cum_pred_ar1_upper=cumsum(AR1_upper),
#          Cum_pred_rw2=cumsum(rw2_mean),Cum_pred_rw2_lower=cumsum(rw2_lower),Cum_pred_rw2_upper=cumsum(rw2_upper))
```



## Short-term prediction of the total number of reported COVID-19 cases

We fit the two models described in the previous section to the daily reported new COVID-19 cases. The parameter estimates for the two models are presented in Supplementary Table 1. As depicted in Figure 3, two models fitted to the data appear to fit the observed data (within the estimation period) well with a narrow confidence interval obtained for the $RW(2)$ model.  The two models provides similar predictions over the 7-day ahead period.



```{r message = FALSE, warning = FALSE}
forcast_cum<-Day7_pred%>%
  ggplot(aes(y=total, x=date2)) +
  geom_blank()+
  geom_point(aes(y=total, x=date2)) +
  geom_line(aes(y=Cum_pred_rw2, x=date2),linetype = "dashed", color="red") +
  geom_line(aes(y=Cum_pred_ar1, x=date2),color="blue") +
    geom_ribbon(aes(ymin=Cum_pred_rw2_lower, ymax=Cum_pred_rw2_upper), fill="#FF00007F", alpha=0.4) +
    geom_ribbon(aes(ymin=Cum_pred_ar1_lower, ymax=Cum_pred_ar1_upper), fill='#0000FF7F', alpha=0.4) +
  xlab("Date")+
  ylab("Cummulative observed and fitted cases")+
  #labs(title = "Negative-Binomial model - 7 days a head forcasting")+
  theme_bw()

forcast_cum<-forcast_cum+annotate("segment", x = as.Date("2020-10-06","%Y-%m-%d"), xend = as.Date("2021-02-06","%Y-%m-%d"), y = 1500000, yend = 1500000,
         colour = "black", size = 1, arrow = arrow())

forcast_cum_zoom<-Day7_pred[Day7_pred$time>324,]%>%
  ggplot(aes(y=total, x=date2)) +
  geom_blank()+
  geom_point(aes(y=total, x=date2)) +
  geom_line(aes(y=Cum_pred_rw2, x=date2),linetype = "dashed", color="red") +
  geom_line(aes(y=Cum_pred_ar1, x=date2),color="blue") +
  ylab(" ")+
  xlab("Date")+
  theme_bw()

forcast_cum_all<-forcast_cum + inset_element(forcast_cum_zoom, left =0.1, right =0.7, bottom = 0.5, top =0.99)

```

```{r predd,out.width = "99%", fig.cap = "Predicted cummulative COVID-19 cases in South Africa under the RW(1) and AR(1) model. Estimation period 12/03/2020-20/02/2021. The black dots are the observed cummulative cases. The red dashed lines are for RW(2) and the blue line for AR(1).The shaded bands are the prediction intervals. "}

forcast_cum_all

```


```{r message = FALSE, warning = FALSE}
# table 
Frocasting7<-Day7_pred[Day7_pred$time>345,c("date2","total","Cum_pred_rw2", "Cum_pred_rw2_lower", "Cum_pred_rw2_upper"
                                            ,"Cum_pred_ar1", "Cum_pred_ar1_lower", "Cum_pred_ar1_upper")]

Frocasting7$Pred_Int_rw2<-paste0("(",round(Frocasting7$Cum_pred_rw2_lower,digits=2), "-", round(Frocasting7$Cum_pred_rw2_upper,digits=2),")")
Frocasting7$Pred_Int_ar1<-paste0("(",round(Frocasting7$Cum_pred_ar1_lower,digits=2), "-", round(Frocasting7$Cum_pred_ar1_upper,digits=2),")")

F1<-Frocasting7[,c("date2","total","Cum_pred_rw2","Pred_Int_rw2")]
F2<-Frocasting7[,c("date2","total","Cum_pred_ar1","Pred_Int_ar1")]
names(F1)<-c("Date","Total","Prediction","Prediction Interval")
names(F2)<-c("Date","Total","Prediction","Prediction Interval")


F1%>%
   mutate(Prediction_error=Total-Prediction)%>%
  rename("Total - Prediction"=Prediction_error)%>%
kable(caption = "Short-term predictions of total number of reported cases at the national level under the rw2 model. Estimation period 12/03/2020-20/02/2021") %>%
kable_classic_2(full_width = F)%>%
  kableExtra::kable_styling(latex_options = "hold_position")

F2%>%
  mutate(Prediction_error=Total-Prediction)%>%
  rename("Total - Prediction"=Prediction_error)%>%
kable(caption = "Short-term predictions of total number of reported cases at the national level under the AR1 model. Estimation period 12/03/2020-20/02/2021") %>%
kable_classic_2(full_width = F)%>%
  kableExtra::kable_styling(latex_options = "hold_position")

```


```{r message = FALSE, warning = FALSE}
# table 
Summary_ar1<-round(rbind(nb.ar1$summary.fixed[,c(1,2,3,5)],nb.ar1$summary.hyperpar[,c(1,2,3,5)]),digits=3)
row.names(Summary_ar1)[2]<-"Size"
Summary_ar1%>%
kable(caption = "Parameter estimates AR1 model") %>%
kable_classic_2(full_width = F)%>%
  kableExtra::kable_styling(latex_options = "hold_position")

Summary_rw2<-round(rbind(nb.rw2$summary.fixed[,c(1,2,3,5)],nb.rw2$summary.hyperpar[,c(1,2,3,5)]),digits=3)
row.names(Summary_rw2)[2]<-"Size"
Summary_rw2%>%
kable(caption = "Parameter estimates RW2 model") %>%
kable_classic_2(full_width = F)%>%
  kableExtra::kable_styling(latex_options = "hold_position")

IC<-rbind(cbind(nb.ar1$dic$dic, nb.ar1$waic$waic),
cbind(nb.rw2$dic$dic, nb.rw2$waic$waic))
IC<-data.frame(IC)
row.names(IC)<-c("AR1","RW1")
colnames(IC)<-c("DIC","WAIC")

#rownames(IC)<-("AR1","RW2")

IC%>%
kable(caption = "Information Creteria for AR1 and RW2 models") %>%
kable_classic_2(full_width = F)%>%
  kableExtra::kable_styling(latex_options = "hold_position")


```

# References {#references .unnumbered}
